<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PokéBros Tournament</title>

  <!-- Meta -->
  <meta name="description" content="PokéBros Tournament Tracker PWA — players, Swiss pairings, match sheets, leaderboard, and Pokémon TCG card search." />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#e3350d" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="images/icons/icon-192.png" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">


  <!-- Icons / Styles -->
  <link rel="icon" type="image/png" href="images/icons/icon-192.png">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <!-- Hero -->
  <header class="hero">
    <h1>Tournament Tracker</h1>
      </header>

  <!-- Tabs -->
  <nav class="tabs" role="tablist" aria-label="Main Views">
    <button id="tab-tournament" class="tab active" role="tab" aria-selected="true" aria-controls="panel-tournament">Tournament</button>
    <button id="tab-cards" class="tab" role="tab" aria-selected="false" aria-controls="panel-cards">Card Search</button>
  </nav>

  <main id="main">
    <!-- PANEL: Tournament -->
    <div id="panel-tournament" class="tab-panel is-active" role="tabpanel" aria-labelledby="tab-tournament">
      <!-- Leaderboard -->
      <section class="card" aria-labelledby="h2-leaderboard">
        <h2 id="h2-leaderboard">Leaderboard</h2>
        <div class="row">
          <div class="lb-switch" role="group" aria-label="Leaderboard view">
            <button id="lb-current" class="active" type="button">Current Match</button>
            <button id="lb-totals" type="button">Season Totals</button>
          </div>
          <div class="spacer" aria-hidden="true"></div>
          <button id="clear-current-matches" class="danger" type="button">Clear Current Matches</button>
        </div>

        <table id="leaderboard">
          <caption class="visually-hidden">Player rankings and totals</caption>
          <thead>
            <tr><th scope="col">Rank</th><th scope="col">Player</th><th scope="col">Total</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <!-- Players -->
      <section class="card" aria-labelledby="h2-players">
        <h2 id="h2-players">Players</h2>

        <!-- Add Player Row (auto-hides when you have players) -->
        <div class="row" id="add-player-row">
          <label for="player-input" class="visually-hidden">Player name</label>
          <input id="player-input" type="text" placeholder="Add player name…" autocomplete="off" />
          <button id="add-player" type="button">Add Player</button>
          <button id="clear-players" class="danger" type="button">Clear</button>
        </div>

        <!-- Toggle to bring the row back -->
        <div class="row" id="add-player-toggle" style="display:none; justify-content:center;">
          <button type="button">Add more players</button>
        </div>

        <ul id="players-list" aria-live="polite"></ul>
      </section>

      <!-- Rounds -->
      <section class="card" aria-labelledby="h2-rounds">
        <h2 id="h2-rounds">Rounds</h2>
        <div class="row">
          <label for="rounds">Number of rounds</label>
          <input id="rounds" type="number" min="1" max="9" value="4" inputmode="numeric" />
          <button id="build-rounds" type="button">Build Sheets</button>
          <button id="random-r1" type="button">Randomise R1 Pairings</button>
        </div>
        <div id="rounds-container"></div>
      </section>

      <!-- Footer / persistence -->
      <footer>
        <button id="save-data" type="button">Save</button>
        <button id="load-demo" type="button">Load Demo (7 players)</button>
        <button id="reset" class="danger" type="button">Reset All</button>
        <span class="muted">Data is stored locally on your device.</span>
        <span id="save-status" class="muted" aria-live="polite">Saved ✓</span>
        <button id="export-json" type="button">Export (.json)</button>
        <label class="import-label">Import
          <input id="import-json" type="file" accept="application/json" hidden />
        </label>
      </footer>
    </div>

    <!-- PANEL: Card Search -->
    <div id="panel-cards" class="tab-panel" role="tabpanel" aria-labelledby="tab-cards" hidden>
      <section class="card" id="card-search" aria-labelledby="h2-cardsearch">
        <h2 id="h2-cardsearch">Card Search</h2>
        <div class="row">
          <label for="tcg-query" class="visually-hidden">Card name</label>
          <input id="tcg-query" type="text" placeholder="Search by name… (e.g., Gardevoir, Charizard)" />
          <label for="tcg-type" class="visually-hidden">Card type</label>
          <select id="tcg-type">
            <option value="">Any Type</option>
            <option>Grass</option><option>Fire</option><option>Water</option>
            <option>Lightning</option><option>Psychic</option><option>Fighting</option>
            <option>Darkness</option><option>Metal</option><option>Dragon</option><option>Colorless</option>
          </select>
          <label style="display:flex;align-items:center;gap:6px" for="tcg-standard">
            <input type="checkbox" id="tcg-standard" checked />
            Standard (F+)
          </label>
          
        </div>

        <div id="tcg-results" class="tcg-grid" aria-live="polite"></div>
        
       <!-- Card detail modal -->
<div id="card-modal" class="pb-modal" hidden>
  <div class="pb-modal-content card" role="dialog" aria-modal="true" aria-labelledby="card-modal-title">
    <button id="card-modal-close" class="icon-btn" aria-label="Close" style="position:absolute;top:8px;right:8px;">✕</button>
    <div id="card-modal-body"></div>
  </div>
</div>


<div class="card" id="ai-panel">
  <h2 style="margin-top:0">TCG Assistant (beta)</h2>

  <div id="ai-messages" class="ai-messages" aria-live="polite"></div>

  <div class="row" style="gap:8px; align-items:flex-end; margin-top:10px">
    <textarea id="ai-input" rows="2" placeholder="Ask anything about Pokémon TCG… (Enter to send, Shift+Enter for newline)"
              style="flex:1; resize:vertical"></textarea>
    <button id="ai-send" type="button">Ask</button>
    <button id="ai-clear" type="button" class="danger">Clear</button>
  </div>
</div>

        <div class="row">
          <label for="tcg-api-key" class="visually-hidden">Pokémon TCG API key</label>
          <input id="tcg-api-key" type="password" placeholder="Paste Pokémon TCG API key (saved locally)" style="min-width:280px" />
          <button id="tcg-save-key" type="button">Save Key</button>
          <button id="tcg-clear-results" class="danger" type="button">Clear Results</button>
        </div>

        
      </section>
    </div>
  </main>

  <noscript>
    <p class="muted" style="padding:1rem">This app works best with JavaScript enabled.</p>
  </noscript>

  <!-- Scripts -->
  <script defer>
    if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js').then(reg => {
    // If a new SW is already waiting, activate it
    if (reg.waiting) requestSkipWaiting(reg.waiting);

    // Watch for a new SW installing and becoming 'installed'
    reg.addEventListener('updatefound', () => {
      const nw = reg.installing;
      nw?.addEventListener('statechange', () => {
        if (nw.state === 'installed' && navigator.serviceWorker.controller) {
          requestSkipWaiting(nw);
        }
      });
    });
  });
}

function requestSkipWaiting(worker) {
  worker.postMessage({ type: 'SKIP_WAITING' });
  worker.addEventListener('statechange', () => {
    if (worker.state === 'activated') window.location.reload();
  });
}

  </script>
  <script src="app.js" defer></script>
</body>
</html>